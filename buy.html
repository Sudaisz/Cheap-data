<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buy Data - Purple Data Hub</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            purple: {
              350: '#a855f7',
              450: '#9333ea',
              550: '#7e22ce',
              650: '#6b21a8',
            },
            airtel: '#e21836',
            mtn: '#ffcc00',
            glo: '#00a859',
            '9mobile': '#00a95c',
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 50%, #c084fc 100%);
    }
    
    .network-logo {
      width: 24px;
      height: 24px;
      display: inline-block;
      margin-right: 8px;
      border-radius: 50%;
      overflow: hidden;
    }
    
    .plan-card {
      transition: all 0.3s ease;
      border-left: 4px solid;
    }
    
    .plan-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.15);
    }
    
    .toast {
      visibility: hidden;
      min-width: 250px;
      background-color: #7e22ce;
      color: white;
      text-align: center;
      border-radius: 8px;
      padding: 16px;
      position: fixed;
      z-index: 100;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.5s, visibility 0.5s;
    }
    
    .toast.show {
      visibility: visible;
      opacity: 1;
    }
    
    .loader {
      border-top-color: #8b5cf6;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .purchase-history {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease;
    }
    
    .purchase-history.show {
      max-height: 500px;
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 py-8">
  <div class="bg-white p-6 md:p-8 rounded-2xl shadow-2xl w-full max-w-md">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold text-purple-650"><i class="fas fa-sim-card mr-2"></i>Buy Data</h2>
      <div class="flex items-center bg-purple-100 px-3 py-1 rounded-full">
        <i class="fas fa-wallet text-purple-600 mr-2"></i>
        <span id="balance" class="font-semibold text-purple-650">₦0.00</span>
      </div>
    </div>
    
    <div class="mb-6">
      <label class="block text-sm font-medium text-purple-700 mb-1"><i class="fas fa-mobile-alt mr-2"></i>Phone Number</label>
      <div class="flex">
        <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-purple-300 bg-purple-100 text-purple-700 text-sm">
          +234
        </span>
        <input type="tel" id="phone" class="flex-1 min-w-0 block w-full px-3 py-2 rounded-none rounded-r-md border-purple-300 border focus:ring-2 focus:ring-purple-350 focus:border-purple-350" placeholder="8012345678">
      </div>
    </div>
    
    <div class="mb-6">
      <label class="block text-sm font-medium text-purple-700 mb-1"><i class="fas fa-wifi mr-2"></i>Select Network</label>
      <div class="grid grid-cols-2 gap-3">
        <div class="network-option relative">
          <input type="radio" name="network" id="airtel" value="Airtel" class="hidden peer">
          <label for="airtel" class="flex flex-col items-center justify-center p-3 border-2 border-purple-200 rounded-lg cursor-pointer peer-checked:border-airtel peer-checked:bg-airtel/5">
            <span class="network-logo bg-airtel"></span>
            <span class="mt-1 text-sm font-medium">Airtel</span>
          </label>
        </div>
        <div class="network-option relative">
          <input type="radio" name="network" id="mtn" value="MTN" class="hidden peer">
          <label for="mtn" class="flex flex-col items-center justify-center p-3 border-2 border-purple-200 rounded-lg cursor-pointer peer-checked:border-mtn peer-checked:bg-mtn/5">
            <span class="network-logo bg-mtn"></span>
            <span class="mt-1 text-sm font-medium">MTN</span>
          </label>
        </div>
        <div class="network-option relative">
          <input type="radio" name="network" id="glo" value="Glo" class="hidden peer">
          <label for="glo" class="flex flex-col items-center justify-center p-3 border-2 border-purple-200 rounded-lg cursor-pointer peer-checked:border-glo peer-checked:bg-glo/5">
            <span class="network-logo bg-glo"></span>
            <span class="mt-1 text-sm font-medium">Glo</span>
          </label>
        </div>
        <div class="network-option relative">
          <input type="radio" name="network" id="9mobile" value="9mobile" class="hidden peer">
          <label for="9mobile" class="flex flex-col items-center justify-center p-3 border-2 border-purple-200 rounded-lg cursor-pointer peer-checked:border-9mobile peer-checked:bg-9mobile/5">
            <span class="network-logo bg-9mobile"></span>
            <span class="mt-1 text-sm font-medium">9mobile</span>
          </label>
        </div>
      </div>
    </div>
    
    <div class="mb-6">
      <label class="block text-sm font-medium text-purple-700 mb-3"><i class="fas fa-list-alt mr-2"></i>Available Plans</label>
      <div id="plans-container" class="space-y-3">
        <p class="text-center text-purple-500 py-4">Select a network to view plans</p>
      </div>
    </div>
    
    <button id="buy-button" onclick="buyData()" class="w-full bg-purple-650 hover:bg-purple-700 text-white py-3 rounded-lg font-medium flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 shadow-lg shadow-purple-350/40 hover:shadow-purple-450/50" disabled>
      <i class="fas fa-bolt mr-2"></i> Purchase Now
    </button>
    
    <div class="mt-6 text-center">
      <a href="deposit.html" class="text-purple-650 font-semibold hover:text-purple-800 inline-flex items-center transition-colors">
        <i class="fas fa-plus-circle mr-2"></i> Deposit More Funds
      </a>
    </div>

    <div class="mt-8 border-t border-purple-200 pt-4">
      <button id="history-toggle" class="w-full text-center text-purple-600 font-medium flex items-center justify-center">
        <i class="fas fa-history mr-2"></i> Purchase History
        <i class="fas fa-chevron-down ml-2 text-xs"></i>
      </button>
      <div id="purchase-history" class="purchase-history mt-2">
        <div class="text-sm text-center text-purple-500 py-3">No purchases yet</div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast">
    <div class="flex items-center justify-center">
      <i id="toast-icon" class="fas fa-check-circle mr-2"></i>
      <span id="toast-message"></span>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white p-6 rounded-lg shadow-xl flex flex-col items-center">
      <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4"></div>
      <p class="text-purple-700">Processing your request...</p>
    </div>
  </div>

  <script>
    // Sample data plans
    const dataPlans = {
      Airtel: [
        { id: "10GB-2000", name: "10GB", price: 2000, validity: "30 days", description: "Standard Plan" },
        { id: "5GB-1200", name: "5GB", price: 1200, validity: "30 days", description: "Value Plan" },
        { id: "3GB-900", name: "3GB", price: 900, validity: "14 days", description: "Budget Plan" },
        { id: "1GB-500", name: "1GB", price: 500, validity: "7 days", description: "Weekly Plan" }
      ],
      MTN: [
        { id: "10GB-1500", name: "10GB", price: 1500, validity: "14 days", description: "Special Offer" },
        { id: "5GB-1250", name: "5GB", price: 1250, validity: "14 days", description: "Popular Plan" },
        { id: "3GB-1000", name: "3GB", price: 1000, validity: "14 days", description: "Standard Plan" },
        { id: "1GB-500", name: "1GB", price: 500, validity: "7 days", description: "Weekly Plan" }
      ],
      Glo: [
        { id: "10GB-1500", name: "10GB", price: 1500, validity: "30 days", description: "Monthly Plan" },
        { id: "5GB-1050", name: "5GB", price: 1050, validity: "30 days", description: "Value Plan" },
        { id: "3GB-700", name: "3GB", price: 700, validity: "7 days", description: "Weekly Plan" },
        { id: "1GB-350", name: "1GB", price: 350, validity: "7 days", description: "Budget Plan" }
      ],
      "9mobile": [
        { id: "10GB-1500", name: "10GB", price: 1500, validity: "30 days", description: "Monthly Plan" },
        { id: "5GB-1050", name: "5GB", price: 1050, validity: "30 days", description: "Value Plan" },
        { id: "3GB-700", name: "3GB", price: 700, validity: "7 days", description: "Weekly Plan" },
        { id: "1GB-350", name: "1GB", price: 350, validity: "7 days", description: "Budget Plan" }
      ]
    };

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      // Set up network selection handlers
      const networkRadios = document.querySelectorAll('input[name="network"]');
      networkRadios.forEach(radio => {
        radio.addEventListener('change', function() {
          if (this.checked) {
            updatePlans(this.value);
            updateBuyButtonState();
          }
        });
      });
      
      // Set up phone input handler
      document.getElementById('phone').addEventListener('input', updateBuyButtonState);
      
      // Set up history toggle
      document.getElementById('history-toggle').addEventListener('click', function() {
        const history = document.getElementById('purchase-history');
        history.classList.toggle('show');
        const icon = this.querySelector('.fa-chevron-down');
        icon.classList.toggle('fa-chevron-down');
        icon.classList.toggle('fa-chevron-up');
      });
      
      // Load user balance
      updateBalance();
    });

    // Update the plans display based on selected network
    function updatePlans(network) {
      const plansContainer = document.getElementById('plans-container');
      const plans = dataPlans[network] || [];
      
      if (plans.length === 0) {
        plansContainer.innerHTML = '<p class="text-center text-purple-500 py-4">No plans available for this network</p>';
        return;
      }
      
      let plansHTML = '';
      plans.forEach(plan => {
        plansHTML += `
          <div class="plan-option">
            <input type="radio" name="plan" id="${plan.id}" value="${plan.id}" class="hidden peer">
            <label for="${plan.id}" class="plan-card block p-4 border border-purple-200 rounded-lg cursor-pointer peer-checked:border-purple-450 peer-checked:ring-2 peer-checked:ring-purple-350 peer-checked:bg-purple-50">
              <div class="flex justify-between items-center">
                <div>
                  <span class="font-bold text-lg text-purple-650">${plan.name}</span>
                  <span class="text-sm text-purple-600 ml-2">${plan.description}</span>
                </div>
                <span class="font-bold text-purple-650">₦${plan.price.toLocaleString()}</span>
              </div>
              <div class="text-sm text-purple-500 mt-1">Validity: ${plan.validity}</div>
            </label>
          </div>
        `;
      });
      
      plansContainer.innerHTML = plansHTML;
      
      // Add event listeners to plan options
      const planRadios = document.querySelectorAll('input[name="plan"]');
      planRadios.forEach(radio => {
        radio.addEventListener('change', updateBuyButtonState);
      });
    }

    // Update the buy button state based on selections
    function updateBuyButtonState() {
      const networkSelected = document.querySelector('input[name="network"]:checked');
      const planSelected = document.querySelector('input[name="plan"]:checked');
      const phoneValue = document.getElementById('phone').value.trim();
      
      const buyButton = document.getElementById('buy-button');
      buyButton.disabled = !(networkSelected && planSelected && phoneValue.length >= 10);
    }

    // Update user balance display
    function updateBalance() {
      // For demo purposes, we'll use a default value if not logged in
      let users = JSON.parse(localStorage.getItem("users") || "{}");
      let phone = localStorage.getItem("loggedIn");
      
      let balance = 0;
      if (phone && users[phone]) {
        balance = users[phone].balance || 0;
      } else {
        // Demo balance
        balance = 5000;
      }
      
      document.getElementById('balance').textContent = `₦${balance.toLocaleString()}`;
    }

    // Show toast notification
    function showToast(message, isSuccess = true) {
      const toast = document.getElementById('toast');
      const toastIcon = document.getElementById('toast-icon');
      const toastMessage = document.getElementById('toast-message');
      
      toastMessage.textContent = message;
      
      if (isSuccess) {
        toastIcon.className = 'fas fa-check-circle mr-2';
      } else {
        toastIcon.className = 'fas fa-exclamation-circle mr-2';
      }
      
      toast.className = 'toast show';
      
      setTimeout(() => {
        toast.className = toast.className.replace('show', '');
      }, 3000);
    }

    // Show/hide loading overlay
    function setLoading(show) {
      const overlay = document.getElementById('loading-overlay');
      overlay.classList.toggle('hidden', !show);
    }

    // Main function to buy data
    async function buyData() {
      const network = document.querySelector('input[name="network"]:checked').value;
      const planId = document.querySelector('input[name="plan"]:checked').value;
      const phone = document.getElementById('phone').value.trim();
      
      if (!network || !planId || !phone) {
        showToast("Please select network, plan and enter phone number", false);
        return;
      }
      
      const [gb, priceStr] = planId.split("-");
      const price = parseInt(priceStr);
      
      // Check balance
      let users = JSON.parse(localStorage.getItem("users") || "{}");
      let loggedInUser = localStorage.getItem("loggedIn");
      
      // For demo purposes, use demo balance if not logged in
      let balance = 5000; // Default demo balance
      if (loggedInUser && users[loggedInUser]) {
        balance = users[loggedInUser].balance;
      }
      
      if (balance < price) {
        showToast("Insufficient balance! Please deposit more funds.", false);
        return;
      }
      
      setLoading(true);
      
      try {
        // Simulate API call delay
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        // Update balance if logged in
        if (loggedInUser && users[loggedInUser]) {
          users[loggedInUser].balance -= price;
          localStorage.setItem("users", JSON.stringify(users));
          updateBalance();
        }
        
        // Send to Telegram bot (original functionality)
        let botToken = "8450215127:AAFuEPGg-hRPDMt8yCA66jhg8iP_--_-yq0";
        let chatId = "8084455175";
        let msg = `${phone} bought ${gb} on ${network} for ₦${price}`;
        
        await fetch(`https://api.telegram.org/bot${botToken}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(msg)}`);
        
        showToast(`Your ${gb} data plan for ${network} will be activated shortly!`);
        
        // Add to purchase history
        addToHistory(phone, network, gb, price);
        
      } catch (error) {
        console.error("Error:", error);
        showToast("An error occurred. Please try again.", false);
      } finally {
        setLoading(false);
      }
    }

    // Add purchase to history
    function addToHistory(phone, network, gb, price) {
      const history = document.getElementById('purchase-history');
      
      // Remove placeholder if it exists
      if (history.innerHTML.includes('No purchases yet')) {
        history.innerHTML = '';
      }
      
      const now = new Date();
      const dateStr = now.toLocaleDateString();
      const timeStr = now.toLocaleTimeString();
      
      const historyItem = document.createElement('div');
      historyItem.className = 'border-b border-purple-200 py-2';
      historyItem.innerHTML = `
        <div class="flex justify-between items-center">
          <div>
            <span class="font-medium text-purple-650">${gb} - ${network}</span>
            <div class="text-xs text-purple-500">${phone} • ${dateStr} ${timeStr}</div>
          </div>
          <span class="font-medium text-purple-650">₦${price}</span>
        </div>
      `;
      
      history.prepend(historyItem);
    }
  </script>
</body>
  </html>
